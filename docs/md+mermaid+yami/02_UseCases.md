# EcoShower - Use Cases & Features
## תרחישי שימוש ופיצ'רים

---

## 1. רשימת Features מלאה

| # | Feature | תיאור | משתמש | מנהל |
|---|---------|-------|-------|------|
| 1 | הרשמה למערכת | יצירת חשבון חדש | ✓ | ✓ |
| 2 | התחברות | כניסה עם אימייל וסיסמה | ✓ | ✓ |
| 3 | התנתקות | יציאה מהמערכת | ✓ | ✓ |
| 4 | שחזור סיסמה | איפוס סיסמה באימייל | ✓ | ✓ |
| 5 | עדכון פרופיל | שינוי שם ופרטים | ✓ | ✓ |
| 6 | הוספת מכשיר | רישום מכשיר חדש | ✓ | ✓ |
| 7 | הגדרת טמפרטורה | קביעת טמפרטורת יעד | ✓ | ✓ |
| 8 | צפייה בסטטוס מכשיר | מצב נוכחי (online/offline) | ✓ | ✓ |
| 9 | הפעלת מקלחת | התחלת תהליך חימום | ✓ | ✓ |
| 10 | קבלת התראה | Push כשהמים מוכנים | ✓ | ✓ |
| 11 | צפייה בדשבורד | סיכום חיסכון אישי | ✓ | ✓ |
| 12 | היסטוריית מקלחות | רשימת מקלחות קודמות | ✓ | ✓ |
| 13 | גרפים וסטטיסטיקות | ניתוח נתונים | ✓ | ✓ |
| 14 | ניהול פרופילי משתמשים | פרופילים לבני משפחה | ✓ | ✓ |
| 15 | מחיקת מכשיר | הסרת מכשיר מהחשבון | ✓ | ✓ |
| 16 | צפייה בכל המשתמשים | רשימת כל המשתמשים | ✗ | ✓ |
| 17 | מחיקת משתמש | הסרת משתמש מהמערכת | ✗ | ✓ |
| 18 | צפייה בכל המכשירים | רשימת כל המכשירים | ✗ | ✓ |
| 19 | סטטיסטיקות מערכת | נתונים כלליים | ✗ | ✓ |
| 20 | ניהול התראות | הגדרת סוגי התראות | ✓ | ✓ |

---

## 2. תרחישי שימוש מפורטים (Use Cases)

---

### UC-01: הרשמה למערכת

**Actor:** משתמש חדש

**Preconditions:** 
- למשתמש יש כתובת אימייל תקינה
- המשתמש לא רשום במערכת

**Main Flow:**
1. המשתמש נכנס לדף ההרשמה
2. המשתמש מזין: שם מלא, אימייל, סיסמה
3. המערכת מאמתת את הנתונים:
   - אימייל בפורמט תקין
   - סיסמה לפחות 8 תווים, אות גדולה, מספר, סימן
   - אימייל לא קיים במערכת
4. המערכת יוצרת חשבון ב-Cognito
5. המערכת שולחת אימייל אימות
6. המשתמש לוחץ על קישור האימות
7. המערכת מאשרת את החשבון
8. המשתמש מופנה לדף ההתחברות

**Alternative Flow:**
- 3a. אימייל לא תקין → הצגת שגיאה "כתובת אימייל לא תקינה"
- 3b. סיסמה חלשה → הצגת שגיאה עם דרישות הסיסמה
- 3c. אימייל קיים → הצגת שגיאה "משתמש קיים, התחבר או שחזר סיסמה"

**Postconditions:**
- חשבון משתמש נוצר במערכת
- המשתמש יכול להתחבר

---

### UC-02: התחברות למערכת

**Actor:** משתמש רשום

**Preconditions:**
- למשתמש יש חשבון מאומת

**Main Flow:**
1. המשתמש נכנס לדף ההתחברות
2. המשתמש מזין אימייל וסיסמה
3. המערכת מאמתת מול Cognito
4. המערכת מקבלת JWT tokens (access, refresh, id)
5. המערכת שומרת tokens ב-localStorage
6. המשתמש מופנה לדשבורד

**Alternative Flow:**
- 3a. פרטים שגויים → הצגת שגיאה "אימייל או סיסמה שגויים"
- 3b. חשבון לא מאומת → הצגת שגיאה "יש לאמת את החשבון באימייל"
- 3c. חשבון חסום → הצגת שגיאה "החשבון חסום, פנה למנהל"

**Postconditions:**
- המשתמש מחובר למערכת
- Token נשמר לשימוש ב-API calls

---

### UC-03: הוספת מכשיר חדש

**Actor:** משתמש מחובר

**Preconditions:**
- המשתמש מחובר למערכת
- למשתמש יש מכשיר EcoShower פיזי

**Main Flow:**
1. המשתמש נכנס לדף "המכשירים שלי"
2. המשתמש לוחץ "הוסף מכשיר"
3. המערכת מציגה טופס:
   - שם המכשיר (לדוגמה: "מקלחת ראשית")
   - קוד המכשיר (מודפס על המכשיר)
4. המשתמש מזין את הפרטים
5. המערכת מאמתת את קוד המכשיר מול IoT Core
6. המערכת יוצרת רשומה ב-DynamoDB
7. המערכת מציגה הוראות WiFi setup
8. המשתמש מגדיר WiFi במכשיר
9. המכשיר מתחבר ל-IoT Core
10. המערכת מציגה "המכשיר מחובר בהצלחה"

**Alternative Flow:**
- 5a. קוד לא תקין → הצגת שגיאה "קוד מכשיר לא נמצא"
- 5b. מכשיר כבר רשום → הצגת שגיאה "המכשיר רשום למשתמש אחר"
- 9a. המכשיר לא מתחבר → הצגת הוראות troubleshooting

**Postconditions:**
- המכשיר רשום למשתמש
- המכשיר מחובר ומוכן לשימוש

---

### UC-04: הפעלת מקלחת (Smart Ready)

**Actor:** משתמש מחובר

**Preconditions:**
- למשתמש יש מכשיר מחובר
- המכשיר במצב online

**Main Flow:**
1. המשתמש נכנס לאפליקציה
2. המשתמש בוחר מכשיר
3. המשתמש רואה את הטמפרטורה הנוכחית
4. המשתמש מגדיר טמפרטורת יעד (ברירת מחדל: 38°C)
5. המשתמש לוחץ "התחל חימום"
6. המערכת שולחת פקודה ל-ESP32
7. ESP32 מפעיל את משאבת הסירקולציה
8. ESP32 שולח עדכוני טמפרטורה כל 2 שניות
9. המערכת מציגה את ההתקדמות בזמן אמת
10. כשהטמפרטורה מגיעה ליעד:
    - Lambda שולח Push notification
    - ESP32 פותח את הברז הראשי
    - המערכת מציגה "המים מוכנים!"
11. המשתמש נכנס למקלחת
12. לאחר 30 שניות ללא זרימה, המערכת מסיימת את ה-session

**Alternative Flow:**
- 7a. המכשיר לא מגיב → הצגת שגיאה "המכשיר אינו מגיב"
- 10a. timeout אחרי 10 דקות → הצגת שגיאה "לא הושגה טמפרטורה"

**Postconditions:**
- Session נשמר ב-DynamoDB עם נתוני חיסכון
- המשתמש קיבל התראה

---

### UC-05: צפייה בדשבורד

**Actor:** משתמש מחובר

**Preconditions:**
- המשתמש מחובר למערכת

**Main Flow:**
1. המשתמש נכנס לדשבורד
2. המערכת שולחת בקשה ל-API: GET /dashboard/summary
3. Lambda מחשב:
   - סה"כ ליטרים שנחסכו (סכום כל ה-sessions)
   - סה"כ כסף שנחסך (ליטרים × 0.008 ₪)
   - מספר מקלחות החודש
   - ממוצע חיסכון למקלחת
4. המערכת מציגה:
   - כרטיסי סיכום (Cards)
   - גרף חיסכון שבועי (Bar chart)
   - גרף מגמה חודשי (Line chart)
   - טבלת מקלחות אחרונות

**Postconditions:**
- המשתמש רואה את נתוני החיסכון שלו

---

### UC-06: ניהול פרופילי משפחה

**Actor:** משתמש מחובר

**Preconditions:**
- המשתמש מחובר
- יש לו לפחות מכשיר אחד

**Main Flow:**
1. המשתמש נכנס להגדרות → פרופילים
2. המשתמש לוחץ "הוסף פרופיל"
3. המשתמש מזין:
   - שם הפרופיל (לדוגמה: "אבא", "אמא", "ילד")
   - טמפרטורת יעד מועדפת
   - אייקון/צבע
4. המערכת שומרת את הפרופיל
5. בעת הפעלת מקלחת, המשתמש יכול לבחור פרופיל
6. המערכת מחילה את הגדרות הפרופיל

**Postconditions:**
- הפרופיל נשמר ומוכן לשימוש

---

### UC-07: ניהול משתמשים (מנהל)

**Actor:** מנהל מערכת

**Preconditions:**
- המשתמש מחובר עם הרשאות admin

**Main Flow:**
1. המנהל נכנס לפאנל ניהול
2. המנהל לוחץ "ניהול משתמשים"
3. המערכת מציגה טבלה עם כל המשתמשים:
   - שם, אימייל, תאריך הרשמה, מספר מכשירים, סטטוס
4. המנהל יכול:
   - לחפש משתמש
   - לסנן לפי סטטוס
   - לצפות בפרטי משתמש
   - לשנות הרשאות (user ↔ admin)
   - לחסום/לבטל חסימה
   - למחוק משתמש

**Alternative Flow:**
- 4a. מחיקת משתמש → dialog אישור → מחיקת כל המכשירים והנתונים

**Postconditions:**
- השינויים נשמרים במערכת

---

### UC-08: התראות ו-Notifications

**Actor:** משתמש מחובר

**Preconditions:**
- המשתמש נתן הרשאות Push notification

**Main Flow:**
1. המערכת מזהה אירוע:
   - המים הגיעו לטמפרטורה (WATER_READY)
   - מכשיר התנתק (DEVICE_OFFLINE)
   - נזילה/אנומליה (MAINTENANCE_ALERT)
2. Lambda יוצר הודעה ב-SNS
3. SNS שולח Push notification לטלפון
4. ההודעה מופיעה כ-notification
5. המשתמש לוחץ → נפתחת האפליקציה בדף הרלוונטי

**Postconditions:**
- המשתמש קיבל את ההתראה

---

## 3. UML Sequence Diagrams

### SD-01: הפעלת מקלחת

```
User        Frontend       API GW       Lambda        IoT Core      ESP32        DynamoDB      SNS
 |             |              |            |              |            |              |          |
 |--Start----->|              |            |              |            |              |          |
 |             |--POST /cmd-->|            |              |            |              |          |
 |             |              |--Invoke--->|              |            |              |          |
 |             |              |            |--Publish---->|            |              |          |
 |             |              |            |              |--MQTT----->|              |          |
 |             |              |            |              |            |--Start pump--|          |
 |             |              |            |<----200------|            |              |          |
 |             |<---200-------|            |              |            |              |          |
 |             |              |            |              |            |              |          |
 |             |              |            |              |<--Temp-----|              |          |
 |             |              |            |<--IoT Rule---|            |              |          |
 |             |              |            |--Store------>|            |              |          |
 |             |              |            |              |            |              |--Write-->|
 |             |              |            |              |            |              |          |
 |             |<--WebSocket--|            |              |            |              |          |
 |<--Update----|              |            |              |            |              |          |
 |             |              |            |              |            |              |          |
 |  [Loop until temp >= target]           |              |            |              |          |
 |             |              |            |              |            |              |          |
 |             |              |            |--Check temp->|            |              |          |
 |             |              |            |   temp >= 38 |            |              |          |
 |             |              |            |--Open valve->|            |              |          |
 |             |              |            |              |--MQTT----->|              |          |
 |             |              |            |              |            |--Open--------|          |
 |             |              |            |--Notify----->|            |              |          |
 |             |              |            |              |            |              |          |--Publish->|
 |<--Push Notification--------|------------|--------------|------------|--------------|----------|          |
 |             |              |            |              |            |              |          |
```

### SD-02: התחברות

```
User        Frontend       API GW       Cognito       Lambda        DynamoDB
 |             |              |            |              |              |
 |--Login----->|              |            |              |              |
 |             |--POST auth-->|            |              |              |
 |             |              |--Validate->|              |              |
 |             |              |            |--Verify----->|              |
 |             |              |            |<--User info--|              |
 |             |              |<--Tokens---|              |              |
 |             |<--JWT--------|            |              |              |
 |             |--Store token |            |              |              |
 |             |--GET profile>|            |              |              |
 |             |              |--Authorize>|              |              |
 |             |              |            |<--Valid------|              |
 |             |              |--Invoke--->|              |              |
 |             |              |            |              |--Query------>|
 |             |              |            |              |<--User data--|
 |             |              |<--Profile--|              |              |
 |             |<--User data--|            |              |              |
 |<--Dashboard-|              |            |              |              |
 |             |              |            |              |              |
```

---

## 4. בדיקות קלט (Input Validation)

### Registration Form
| Field | Validation | Error Message |
|-------|------------|---------------|
| name | 2-50 chars, letters/spaces | "שם חייב להכיל 2-50 תווים" |
| email | Valid email format | "כתובת אימייל לא תקינה" |
| password | 8+ chars, 1 upper, 1 number, 1 symbol | "הסיסמה חייבת להכיל..." |
| confirm_password | Must match password | "הסיסמאות לא תואמות" |

### Device Settings
| Field | Validation | Error Message |
|-------|------------|---------------|
| device_name | 2-30 chars | "שם מכשיר לא תקין" |
| target_temp | 30-45°C | "טמפרטורה חייבת להיות 30-45°C" |
| device_code | 12 chars alphanumeric | "קוד מכשיר לא תקין" |

### Profile
| Field | Validation | Error Message |
|-------|------------|---------------|
| profile_name | 1-20 chars | "שם פרופיל לא תקין" |
| target_temp | 30-45°C | "טמפרטורה לא תקינה" |

